namespace authz.manager.curity.io{
    
    policyset authzManager{
        
        apply firstApplicable

        policyset graphQLDCR{
            target clause resourceType == "dcr" 

            apply firstApplicable

            /*Policy that only returns permit but requires a very explicit access request for admin*/
            policy admin{
                target clause group == "admin"

                apply firstApplicable

                rule read{
                    target clause apiAction == "read" or apiAction == "GET"
                    permit
                }

                rule create{
                    target clause apiAction == "create" or apiAction == "POST"
                    permit
                }

                rule update{
                    target clause apiAction == "update" or apiAction == "PUT"
                    permit
                }

                rule delete{
                    target clause apiAction == "delete" or apiAction == "DELETE"
                    permit
                }
            }

            /*Policy that returns permit with obligation*/
            policy devops{
                target clause group == "devops"

                apply firstApplicable

                rule read{
                    target clause apiAction == "read" or apiAction == "GET"
                    permit
                    on permit {
                        obligation curityFilters{
                            status = false
                        }   
                    }
                }

                rule create{
                    target clause apiAction == "create" or apiAction == "POST"
                    permit
                }
            }
        }


        policyset graphQLUM{
            target clause resourceType == "user-management"

            apply firstApplicable

            /*Policy that only returns permit but requires a very explicit access request for admin*/
            policy admin{
                target clause group == "admin"

                apply firstApplicable

                rule read{
                    target clause apiAction == "read" or apiAction == "GET"
                    permit
                }

                rule create{
                    target clause apiAction == "create" or apiAction == "POST"
                    permit
                }

                rule update{
                    target clause apiAction == "update" or apiAction == "PUT"
                    permit
                }

                rule delete{
                    target clause apiAction == "delete" or apiAction == "DELETE"
                    permit
                }
            }

            /* Policy that returns permit with obligation */
            policy devops{
                target clause group == "devops"

                apply firstApplicable

                rule read{
                    target clause apiAction == "read" or apiAction == "GET"
                    permit
                    on permit {
                        obligation curityFilters{
                            phoneNumbers = true
                            name = true
                        }   
                    }
                }

                rule create{
                    target clause apiAction == "create" or apiAction == "POST"
                    permit
                }
            }
        }

    }
}